% Married characters
married("Владимир Павлович Шуст").
married("Татьяна Петровна Шуст").
married("Иван Владимирович Шуст").
married("Арина Александровна Шуст").
married("Елена Петровна Исмаилова").
married("Дмитрий Дмитриевич Исмаилов").
married("Антонина Павловна Адамова").
married("Петр Михаилович Адамов").
married("Варвара Игнатова Адамова").
married("Михаил Григорьевич Адамов").
married("Игорь Александрович Федоров").
married("Алла Павловна Федорова").
married("Евгения Евдокимовна Шуст").
married("Павел Дмитриевич Шуст").
married("Елизавета Карловна Шуст").
married("Дмитрий Константинович Шуст").
married("Даниил Карлович Куранов").
married("Дарья Владимировна Куранова").
married("Карл Куранов").
married("Валентина Сергеевна Куранова").

% Bachelors
bachelor("Николай Михаилович Адамов").
bachelor("Сергей Игоревич Федоров").
bachelor("Кирилл Игоревич Федоров").
bachelor("Эльчин Дмитриевич Исмаилов").
bachelor("Леонид Даниилович Куранов").

% Bachelorettes
bachelorette("Алена Михайловна Адамова").
bachelorette("Марья Владимировна Шуст").
bachelorette("Екатерина Данииловна Куранова").
bachelorette("Анна Игоревна Федорова").

% Spouse relationships 
spouse("Варвара Игнатова Адамова", "Михаил Григорьевич Адамов", date(15.03.1949)).
spouse("Антонина Павловна Адамова", "Петр Михаилович Адамов", date(11.11.1972)).
spouse("Елена Петровна Исмаилова", "Дмитрий Дмитриевич Исмаилов", date(03.09.1999)).
spouse("Татьяна Петровна Шуст", "Владимир Павлович Шуст", date(24.08.1996)).
spouse("Арина Александровна Шуст", "Иван Владимирович Шуст", date(31.07.2024)).
spouse("Алла Павловна Федорова", "Игорь Александрович Федоров", date(20.08.1988)).
spouse("Евгения Евдокимовна Шуст", "Павел Дмитриевич Шуст", date(08.09.1970)).
spouse("Елизавета Карловна Шуст", "Дмитрий Константинович Шуст", date(30.05.1938)).
spouse("Валентина Сергеевна Куранова", "Карл Куранов", date(23.06.1926)).
spouse("Дарья Владимировна Куранова", "Даниил Карлович Куранов", date(03.07.1946)).

% Dead
dead("Ярослав Владимирович Белый", date(10.10.1923)).
dead("Антонина Павловна Адамова", date(09.05.2000)).
dead("Петр Михаилович Адамов", date(15.04.2020)).
dead("Варвара Игнатова Адамова", date(21.04.2004)).
dead("Михаил Григорьевич Адамов", date(14.01.2005)).
dead("Евгения Евдокимовна Шуст", date(16.06.2009)).
dead("Павел Дмитриевич Шуст", date(27.05.2021)).
dead("Екатерина Данииловна Куранова", date(13.07.2006)).
dead("Леонид Даниилович Куранов", date(17.01.2013)).
dead("Елизавета Карловна Шуст", date(18.03.2001)).
dead("Дмитрий Константинович Шуст", date(15.01.1999)).
dead("Даниил Карлович Куранов", date(03.08.2003)).
dead("Дарья Владимировна Куранова", date(13.09.2008)).
dead("Захар Иванович Курдюков", date(21.09.1941)).
dead("Карл Куранов", date(29.03.1950)).
dead("Валентина Сергеевна Куранова", date(01.08.1973)).

% Born
born("Ярослав Владимирович Белый", date(07.09.1881)).
born("Захар Иванович Курдюков", date(02.03.1905)).
born("Николай Михаилович Адамов", date(31.12.1955)).
born("Сергей Игоревич Федоров", date(11.09.1986)).
born("Кирилл Игоревич Федоров", date(16.07.1994)).
born("Эльчин Дмитриевич Исмаилов", date(02.02.2000)).
born("Леонид Даниилович Куранов", date(18.03.1939)).
born("Алена Михайловна Адамова", date(07.04.1957)).
born("Марья Владимировна Шуст", date(17.07.2005)).
born("Екатерина Данииловна Куранова", date(24.06.1934)).
born("Анна Игоревна Федорова", date(12.03.1991)).
born("Владимир Павлович Шуст", date(03.09.1971)).
born("Татьяна Петровна Шуст", date(16.11.1973)).
born("Иван Владимирович Шуст", date(17.09.1999)).
born("Арина Александровна Шуст", date(17.08.1999)).
born("Елена Петровна Исмаилова", date(24.09.1978)).
born("Дмитрий Дмитриевич Исмаилов", date(15.03.1976)).
born("Антонина Павловна Адамова", date(20.09.1952)).
born("Петр Михаилович Адамов", date(21.11.1955)).
born("Варвара Игнатова Адамова", date(03.05.1929)).
born("Михаил Григорьевич Адамов", date(20.06.1929)).
born("Игорь Александрович Федоров", date(27.01.1965)).
born("Алла Павловна Федорова", date(20.09.1967)).
born("Евгения Евдокимовна Шуст", date(20.08.1939)).
born("Павел Дмитриевич Шуст", date(21.06.1939)).
born("Елизавета Карловна Шуст", date(11.05.1913)).
born("Дмитрий Константинович Шуст", date(18.02.1910)).
born("Даниил Карлович Куранов", date(19.04.1908)).
born("Дарья Владимировна Куранова", date(11.05.1912)).
born("Карл Куранов", date(19.07.1885)).
born("Валентина Сергеевна Куранова", date(20.12.1889)).

% Parent relationships
parent("Татьяна Петровна Шуст", "Марья Владимировна Шуст").
parent("Татьяна Петровна Шуст", "Иван Владимирович Шуст").
parent("Елена Петровна Исмаилова", "Эльчин Дмитриевич Исмаилов").
parent("Михаил Григорьевич Адамов", "Николай Михаилович Адамов").
parent("Михаил Григорьевич Адамов", "Алена Михайловна Адамова").
parent("Михаил Григорьевич Адамов", "Петр Михаилович Адамов").
parent("Антонина Павловна Адамова", "Татьяна Петровна Шуст").
parent("Антонина Павловна Адамова", "Елена Петровна Исмаилова").
parent("Игорь Александрович Федоров", "Сергей Игоревич Федоров").
parent("Игорь Александрович Федоров", "Анна Игоревна Федорова").
parent("Игорь Александрович Федоров", "Кирилл Игоревич Федоров").
parent("Павел Дмитриевич Шуст", "Алла Павловна Федорова").
parent("Елизавета Карловна Шуст", "Павел Дмитриевич Шуст").
parent("Карл Куранов", "Елизавета Карловна Шуст").
parent("Карл Куранов", "Даниил Карлович Куранов").
parent("Даниил Карлович Куранов", "Екатерина Данииловна Куранова").
parent("Даниил Карлович Куранов", "Леонид Даниилович Куранов").

%rules

% 1. Получение текущего возраста человека на основании года рождения
current_year(2025). 

age(Person, Age) :-
    born(Person, date(_, _, BirthYear)),
    current_year(CurrentYear),
    Age is CurrentYear - BirthYear.

% 2. Разведены   
divorced(X) :- 
	married(X),       % X is in married list
      	\+ spouse(X, _).  % but have no couple in spouse list

% 3. Сиблинги
siblings(X, Y) :-
       	parent(Z, X), %Z is a parent of X%
       	parent(Z, Y), % Z is a parent of Y
	Y \= X.     % it's not the same person
 
% 4. Человек является бабушкой или дедушкой (Grandparent) по отношению к другому.
grandparent(X, Y) :- 
	parent(X, Z), % X is a parent of Z
	parent(Z, Y).  % when Z is a parent of Y

% 5. Супруги
spouse(X, Y) :- spouse(Y, X).

% 6. Человек является взрослым (Adult), если его возраст >= 18 лет.
adult(Person) :-
    age(Person, Age),
    Age >= 18.

% 7. Правило: Человек является несовершеннолетним (Minor), если его возраст < 18 лет.
minor(Person) :-
    age(Person, Age),
    Age < 18.

% 8. Правило: Человек является сиротой (Orphan) в определенный год, если оба родителя умерли до этого года.
orphan_in_year(Person, Year) :-
    child(Person, Parent1),
    child(Person, Parent2),
    Parent1 = Parent2, % Учитываем двух разных родителей
    + alive_in_year(Parent1, Year),
    + alive_in_year(Parent2, Year).

% 9. Правило: Человек является вдовцом/вдовой (Widowed) в определенный год.
% Если его супруг(а) умер(ла) до этого года, а сам человек был жив в этом году и не вступил в новый брак.
widowed_in_year(Person, Year) :-
    married(Person),
    spouse(Person, Spouse, _),
    dead(Spouse, DeathDate),
    happened_before_year(DeathDate, Year),
    alive_in_year(Person, Year),
    % Проверяем, что к этому году не появился новый супруг
    + (spouse(Person, NewSpouse, NewWeddingDate),
        NewSpouse = Spouse,
        happened_before_year(NewWeddingDate, Year)).

% 10. Правило: Человек является дядей или тетей (Aunt/Uncle) по отношению к другому.
aunt_or_uncle(AuntUncle, Person) :-
    parent(Parent, Person),
    sibling(AuntUncle, Parent).

% 11. Правило: Человек является прародителем (Ancestor) по отношению к другому.
ancestor(Ancestor, Descendant) :-
    parent(Ancestor, Descendant).
ancestor(Ancestor, Descendant) :-
    parent(Ancestor, Intermediate),
    ancestor(Intermediate, Descendant).

% 12. Правило: Человек является потомком (Descendant) по отношению к другому.
descendant(Descendant, Ancestor) :-
    ancestor(Ancestor, Descendant).

% 13. Правило: Двое людей являются двоюродными братьями или сестрами (Cousins).
cousins(Person1, Person2) :-
    parent(Parent1, Person1),
    parent(Parent2, Person2),
    sibling(Parent1, Parent2).

% 14. Правило: Человек является зятем (Son-in-law) или невесткой (Daughter-in-law).
% Зять: муж дочери.
son_in_law(SonInLaw, ParentInLaw) :-
    female(Child), % Нужно определить female (см. ниже)
    parent(ParentInLaw, Child),
    spouse(SonInLaw, Child, _).

 % 15. Правило: Человек является тестем или свекровью (Parent-in-law).
parent_in_law(ParentInLaw, ChildInLaw) :-
    son_in_law(ChildInLaw, ParentInLaw).
parent_in_law(ParentInLaw, ChildInLaw) :-
    daughter_in_law(ChildInLaw, ParentInLaw).

% 16. Правило: Определение поколения (Generation) человека относительно исходного.
% Базовый случай: человек из самого старого известного поколения (0).
generation(Person, 0) :-
    born(Person, _),
    + parent(_, Person). % У него нет известных родителей
	% 25. Правило: Определение поколения (Generation) человека относительно исходного.
% Базовый случай: человек из самого старого известного поколения (0).
generation(Person, 0) :-
    born(Person, _),
    + parent(_, Person). % У него нет известных родителей

% 17. Правило: Нахождение самого старшего живого члена семьи в году.
oldest_living_in_year(Person, Year) :-
    alive_in_year(Person, Year),
    + (alive_in_year(Other, Year),
        Other = Person,
        age(Other, AgeOther),
        age(Person, AgePerson),
        AgeOther > AgePerson).

  % 18. Правило: Определение пола (Female) на основе окончания отчества или фактов.
female(Person) :-
    (   bachelorette(Person)
    ;   married(Person),
        (   sub_string(Person, _, _, _, "вна")
        ;   sub_string(Person, _, _, _, "ла")
        ;   sub_string(Person, _, _, _, "та")
        )
    ).
	
% 19. Правило: Определение пола (Male) на основе окончания отчества или фактов.
male(Person) :-
    (   bachelor(Person)
    ;   married(Person),
        (   sub_string(Person, _, _, _, "вич")
        ;   sub_string(Person, _, _, _, "лыч")
        ;   sub_string(Person, _, _, _, "рич")
        ;   sub_string(Person, _, _, _, "ерг")
        )
    ).
