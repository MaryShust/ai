% Married characters
married("Владимир Павлович Шуст").
married("Татьяна Петровна Шуст").
married("Иван Владимирович Шуст").
married("Арина Александровна Шуст").
married("Елена Петровна Исмаилова").
married("Дмитрий Дмитриевич Исмаилов").
married("Антонина Павловна Адамова").
married("Петр Михаилович Адамов").
married("Варвара Игнатова Адамова").
married("Михаил Григорьевич Адамов").
married("Игорь Александрович Федоров").
married("Алла Павловна Федорова").
married("Евгения Евдокимовна Шуст").
married("Павел Дмитриевич Шуст").
married("Елизавета Карловна Шуст").
married("Дмитрий Константинович Шуст").
married("Даниил Карлович Куранов").
married("Дарья Владимировна Куранова").
married("Карл Куранов").
married("Валентина Сергеевна Куранова").
married("Ярослав Владимирович Белый").
married("Захар Иванович Курдюков").
married("Ярослав Владимирович Белый").
married("Захар Иванович Курдюков").

% Bachelors
bachelor("Николай Михаилович Адамов").
bachelor("Сергей Игоревич Федоров").
bachelor("Кирилл Игоревич Федоров").
bachelor("Эльчин Дмитриевич Исмаилов").
bachelor("Леонид Даниилович Куранов").

% Bachelorettes
bachelorette("Алена Михайловна Адамова").
bachelorette("Марья Владимировна Шуст").
bachelorette("Екатерина Данииловна Куранова").
bachelorette("Анна Игоревна Федорова").

% Spouse relationships 
spouse("Варвара Игнатова Адамова", "Михаил Григорьевич Адамов", date(15, 03, 1949)).
spouse("Антонина Павловна Адамова", "Петр Михаилович Адамов", date(11, 11, 1972)).
spouse("Елена Петровна Исмаилова", "Дмитрий Дмитриевич Исмаилов", date(03, 09, 1999)).
spouse("Татьяна Петровна Шуст", "Владимир Павлович Шуст", date(24, 08, 1996)).
spouse("Арина Александровна Шуст", "Иван Владимирович Шуст", date(31, 07, 2024)).
spouse("Алла Павловна Федорова", "Игорь Александрович Федоров", date(20, 08, 1988)).
spouse("Евгения Евдокимовна Шуст", "Павел Дмитриевич Шуст", date(08, 09, 1970)).
spouse("Елизавета Карловна Шуст", "Дмитрий Константинович Шуст", date(30, 05, 1938)).
spouse("Валентина Сергеевна Куранова", "Карл Куранов", date(23, 06, 1926)).
spouse("Дарья Владимировна Куранова", "Даниил Карлович Куранов", date(03, 07, 1946)).

% Dead
dead("Ярослав Владимирович Белый", date(10, 10, 1923)).
dead("Антонина Павловна Адамова", date(09, 05, 2000)).
dead("Петр Михаилович Адамов", date(15, 04, 2020)).
dead("Варвара Игнатова Адамова", date(21, 04, 2004)).
dead("Михаил Григорьевич Адамов", date(14, 01, 2005)).
dead("Евгения Евдокимовна Шуст", date(16, 06, 2009)).
dead("Павел Дмитриевич Шуст", date(27, 05, 2021)).
dead("Екатерина Данииловна Куранова", date(13, 07, 2006)).
dead("Леонид Даниилович Куранов", date(17, 01, 2013)).
dead("Елизавета Карловна Шуст", date(18, 03, 2001)).
dead("Дмитрий Константинович Шуст", date(15, 01, 1999)).
dead("Даниил Карлович Куранов", date(03, 08, 2003)).
dead("Дарья Владимировна Куранова", date(13, 09, 2008)).
dead("Захар Иванович Курдюков", date(2, 09, 1941)).
dead("Карл Куранов", date(29, 03, 1950)).
dead("Валентина Сергеевна Куранова", date(01, 08, 1973)).

% Born
born("Ярослав Владимирович Белый", date(07, 09, 1881)).
born("Захар Иванович Курдюков", date(02, 03, 1905)).
born("Николай Михаилович Адамов", date(31, 12, 1955)).
born("Сергей Игоревич Федоров", date(11, 09, 1986)).
born("Кирилл Игоревич Федоров", date(16, 07, 1994)).
born("Эльчин Дмитриевич Исмаилов", date(02, 02, 2000)).
born("Леонид Даниилович Куранов", date(18, 03, 1939)).
born("Алена Михайловна Адамова", date(07, 04, 1957)).
born("Марья Владимировна Шуст", date(17, 07, 2005)).
born("Екатерина Данииловна Куранова", date(24, 06, 1934)).
born("Анна Игоревна Федорова", date(12, 03, 1991)).
born("Владимир Павлович Шуст", date(03, 09, 1971)).
born("Татьяна Петровна Шуст", date(16, 11, 1973)).
born("Иван Владимирович Шуст", date(17, 09, 1999)).
born("Арина Александровна Шуст", date(17, 08, 1999)).
born("Елена Петровна Исмаилова", date(24, 09, 1978)).
born("Дмитрий Дмитриевич Исмаилов", date(15, 03, 1976)).
born("Антонина Павловна Адамова", date(20, 09, 1952)).
born("Петр Михаилович Адамов", date(21, 11, 1955)).
born("Варвара Игнатова Адамова", date(03, 05, 1929)).
born("Михаил Григорьевич Адамов", date(20, 06, 1929)).
born("Игорь Александрович Федоров", date(27, 01, 1965)).
born("Алла Павловна Федорова", date(20, 09, 1967)).
born("Евгения Евдокимовна Шуст", date(20, 08, 1939)).
born("Павел Дмитриевич Шуст", date(21, 06, 1939)).
born("Елизавета Карловна Шуст", date(11, 05, 1913)).
born("Дмитрий Константинович Шуст", date(18, 02, 1910)).
born("Даниил Карлович Куранов", date(19, 04, 1908)).
born("Дарья Владимировна Куранова", date(11, 05, 1912)).
born("Карл Куранов", date(19, 07, 1885)).
born("Валентина Сергеевна Куранова", date(20, 12, 1889)).

% Parent relationships
parent("Татьяна Петровна Шуст", "Марья Владимировна Шуст").
parent("Татьяна Петровна Шуст", "Иван Владимирович Шуст").
parent("Владимир Павлович Шуст", "Марья Владимировна Шуст").
parent("Владимир Павлович Шуст", "Иван Владимирович Шуст").
parent("Елена Петровна Исмаилова", "Эльчин Дмитриевич Исмаилов").
parent("Михаил Григорьевич Адамов", "Николай Михаилович Адамов").
parent("Михаил Григорьевич Адамов", "Алена Михайловна Адамова").
parent("Михаил Григорьевич Адамов", "Петр Михаилович Адамов").
parent("Антонина Павловна Адамова", "Татьяна Петровна Шуст").
parent("Антонина Павловна Адамова", "Елена Петровна Исмаилова").
parent("Петр Михаилович Адамов", "Татьяна Петровна Шуст").
parent("Петр Михаилович Адамов", "Елена Петровна Исмаилова").
parent("Игорь Александрович Федоров", "Сергей Игоревич Федоров").
parent("Игорь Александрович Федоров", "Анна Игоревна Федорова").
parent("Игорь Александрович Федоров", "Кирилл Игоревич Федоров").
parent("Павел Дмитриевич Шуст", "Владимир Павлович Шуст").
parent("Павел Дмитриевич Шуст", "Алла Павловна Федорова").
parent("Евгения Евдокимовна Шуст", "Алла Павловна Федорова").
parent("Елизавета Карловна Шуст", "Павел Дмитриевич Шуст").
parent("Карл Куранов", "Елизавета Карловна Шуст").
parent("Карл Куранов", "Даниил Карлович Куранов").
parent("Даниил Карлович Куранов", "Леонид Даниилович Куранов").
parent("Даниил Карлович Куранов", "Екатерина Данииловна Куранова").

%rules

% 1. Получение текущего возраста человека на основании года рождения

current_year(2025). 

age(Person, Age) :-
    born(Person, date(_, _, BirthYear)),
    (   dead(Person, date(_, _, DeathYear)) 
    ->  Age is DeathYear - BirthYear
    ;   current_year(CurrentYear),
        Age is CurrentYear - BirthYear
    ).

% 2.  Правило для определения, что человек является не единственным ребенком
not_only_child(Person) :-
    parent(Parent, Person), (parent(Parent, Sibling), Sibling \= Person).

% 3. Сиблинги
siblings(X, Y) :-
       	parent(Z, X), %Z is a parent of X%
       	parent(Z, Y), % Z is a parent of Y
	Y \= X.     % it's not the same person
 
% 4. Человек является бабушкой или дедушкой (Grandparent) по отношению к другому.
grandparent(X, Y) :- 
	parent(X, Z), % X is a parent of Z
	parent(Z, Y).  % when Z is a parent of Y

% 5. Супруги
spouse(X, Y) :- spouse(Y, X, _).

% 6. Человек является взрослым (Adult), если его возраст >= 18 лет.
adult(Person) :-
    age(Person, Age),
    Age >= 18.

% Извлечение года из строки даты (формат DD.MM.YYYY)
extract_year(Date, Year) :-
    sub_string(Date, 6, 4, _, YearString),
    number_string(Year, YearString).

% Получение года события (смерти, свадьбы)
event_year(EventDate, Year) :-
    extract_year(EventDate, Year).

% 7. Проверка, был ли человек жив в указанный год
alive_in_year(Person, Year) :-
    born(Person, date(_, _, BirthYear)),
    (dead(Person, date(_, _, DeathYear)) -> 
        Year >= BirthYear, Year =< DeathYear
    ; 
        Year >= BirthYear
    ).

% 8. Правило: Человек является сиротой (Orphan) в определенный год, если оба родителя умерли до этого года.
orphan_in_year(Person, Year) :-
    parent(Parent1, Person),
    parent(Parent2, Person),
    Parent1 \= Parent2, % Учитываем двух разных родителей
    dead(Parent1, date(_, _, Year1)), Year1 < Year,
    dead(Parent2, date(_, _, Year2)), Year2 < Year.

% 9. Правило: Родитель-одиночка (Single Parent) в определенный году.
single_parent_in_year(Parent, Year) :-
    parent(Parent, Child),
    parent(Parent2, Child),
    Parent \= Parent2,
    alive_in_year(Child, Year),
    alive_in_year(Parent, Year), dead(Parent2, date(_, _, Year2)), Year2 < Year.

% 10. Правило: Человек является дядей или тетей (Aunt/Uncle) по отношению к другому.
aunt_or_uncle(AuntUncle, Person) :-
    parent(Parent, Person),
    siblings(AuntUncle, Parent).

% 11. Правило: Человек является прародителем (Ancestor) по отношению к другому.
ancestor(Ancestor, Descendant) :-
    parent(Ancestor, Descendant).
ancestor(Ancestor, Descendant) :-
    parent(Ancestor, Intermediate),
    ancestor(Intermediate, Descendant).

% 12. Правило: Человек является потомком (Descendant) по отношению к другому.
descendant(Descendant, Ancestor) :-
    ancestor(Ancestor, Descendant).

% 13. Правило: Двое людей являются двоюродными братьями или сестрами (Cousins).
cousins(Person1, Person2) :-
    parent(Parent1, Person1),
    parent(Parent2, Person2),
    sibling(Parent1, Parent2).

% 14. Правило: Человек является зятем (Son-in-law) или невесткой (Daughter-in-law).
% Зять: муж дочери.
son_in_law(SonInLaw, ParentInLaw) :-
    female(Child),
    parent(ParentInLaw, Child),
    spouse(Child, SonInLaw, _).

daughter_in_law(DaughterInLaw, ParentInLaw) :-
    male(Child),
    parent(ParentInLaw, Child),
    spouse(DaughterInLaw, Child, _).

 % 15. Правило: Человек является тестем или свекровью (Parent-in-law).
parent_in_law(ParentInLaw, ChildInLaw) :-
    son_in_law(ChildInLaw, ParentInLaw).
parent_in_law(ParentInLaw, ChildInLaw) :-
    daughter_in_law(ChildInLaw, ParentInLaw).

% 16. Правило: Определение поколения (Generation) человека относительно исходного.
% Человек из самого старого известного поколения (0).
generation(Person, 0) :-
    born(Person, _),
    not(parent(_, Person)). % У него нет известных родителей

% Поколение потомка на 1 больше поколения родителя.
generation(Person, N) :-
    parent(Parent, Person),
    generation(Parent, M),
    N is M + 1.

% 17. Правило: Семейная пара является бездетной (Childless Couple) в определенный год.
childless_couple_in_year(Wife, Husband, Year) :-
    spouse(Wife, Husband, date(_, _, Y)), Y < Year,
    not(parent(Wife, Child)), 
    not(parent(Husband, Child));
    parent(Wife, Child),
    parent(Husband, Child),
    not(alive_in_year(Child, Year))
    .

  % 18. Правило: Определение пола (Female) на основе окончания отчества или фактов.
female(Person) :-
    (   bachelorette(Person)
    ;   married(Person),
        (   sub_string(Person, _, _, _, "вна")
        ;   sub_string(Person, _, _, _, "ла")
        ;   sub_string(Person, _, _, _, "та")
        )
    ).
	
% 19. Правило: Определение пола (Male) на основе окончания отчества или фактов.
male(Person) :-
    (   bachelor(Person)
    ;   married(Person),
        (   sub_string(Person, _, _, _, "вич")
        ;   sub_string(Person, _, _, _, "лыч")
        ;   sub_string(Person, _, _, _, "рич")
        ;   sub_string(Person, _, _, _, "ерг")
        )
    ).

% 20. Правило для вычисления возраста человека на момент смерти
age_at_death(Person, Age) :-
    dead(Person, date(_, _, DeathYear)),
    born(Person, date(_, _, BirthYear)),
    Age is DeathYear - BirthYear.

% 21. Правило для вычисления длительности брака на момент смерти супруга или на текущий год
marriage_duration(Person1, Person2, Duration) :-
    spouse(Person1, Person2, date(_, _, WeddingYear)),
    (   dead(Person1, date(_, _, DeathYear1)),
        dead(Person2, date(_, _, DeathYear2))
    ->  % Оба умерли - берем меньший год смерти
        min(DeathYear1, DeathYear2, EndYear)
    ;   dead(Person1, date(_, _, DeathYear1))
    ->  % Только Person1 умер
        EndYear = DeathYear1
    ;   dead(Person2, date(_, _, DeathYear2))
    ->  % Только Person2 умер
        EndYear = DeathYear2
    ;   % Оба живы - используем текущий год
        get_time(TimeStamp),
        stamp_date_time(TimeStamp, DateTime, local),
        date_time_value(year, DateTime, EndYear)
    ),
    Duration is EndYear - WeddingYear.

% Вспомогательный предикат для нахождения минимального значения
min(A, B, A) :- A =< B, !.
min(A, B, B) :- B < A.

% 22. Правило для проверки, является ли человек вдовцом/вдовой
widowed(Person) :-
    married(Person),
    spouse(Person, Spouse, _),
    dead(Spouse, _),
    dead(Person, _) = false.

% 23. Правило для родителей, переживших своего ребенка (выводется возраст на который родитель пережил ребенка)
outlived_own_child(Parent, Gap) :-
    parent(Parent, Child),
    dead(Child, date(_, _, ChildDeathYear)),
    dead(Parent, date(_, _, ParentDeathYear)),
    ParentDeathYear > ChildDeathYear,
    Gap is ParentDeathYear - ChildDeathYear.

% 24. Правило для определения молодоженов (брак длится менее 5 лет)
newlyweds(Husband, Wife) :-
    spouse(Husband, Wife, date(_, _, WeddingYear)),
    YearsMarried is 2025 - WeddingYear,
    YearsMarried < 5.

% 25. Правило для определения, что брак был заключен до рождения ребенка
married_before_child(Husband, Wife) :-
    spouse(Husband, Wife, date(_, _, WeddingYear)),
    parent(Husband, Child),
    parent(Wife, Child),
    born(Child, date(_, _, ChildBirthYear)),
    WeddingYear < ChildBirthYear.

% 26. Правило для человека, который никогда не был в браке и старше 30 лет
lifelong_bachelor(Person) :-
    bachelor(Person);
	bachelorette(Person),
    age(Person, Age),
    Age > 30.

% 27. Правило для определения, что ребенок родился у молодых родителей (родителям было меньше 20 лет)
born_to_young_parents(Person) :-
    parent(Parent, Person),
    born(Parent, date(_, _, ParentBirthYear)),
    born(Person, date(_, _, PersonBirthYear)),
    ParentAge is PersonBirthYear - ParentBirthYear,
    ParentAge < 20.

% 29. Правило для определения разницы в возрасте между супругами 
age_gap_marriage(Husband, Wife, Diff) :-
    spouse(Husband, Wife, _),
    age(Husband, AgeH),
    age(Wife, AgeW),
    Diff is abs(AgeH - AgeW).

% 30. Правило для определения, что человек является старшим ребенком (родился раньше всех своих братьев и сестер)
eldest_child(Person) :-
    parent(Parent, Person),
    born(Person, date(_, _, PersonBirthYear)),
    (parent(Parent, Sibling), born(Sibling, date(_, _, SiblingBirthYear)), Sibling \= Person, ! , SiblingBirthYear > PersonBirthYear) .
